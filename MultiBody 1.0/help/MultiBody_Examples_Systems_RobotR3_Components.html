<HTML>
<HEAD><META name="HTML-Generator" content="Dymola"><TITLE>MultiBody</TITLE></HEAD>
<BODY><P>
<!--[if supportFields]><span style='mso-element:field-begin'></span>
<span style='mso-spacerun:yes'></span>XE Components<![endif]-->
<!--[if supportFields]><span style='mso-element:field-end'></span><![endif]-->
<H2><A NAME="MultiBody.Examples.Systems.RobotR3.Components"></A><A HREF="MultiBody_Examples_Systems_RobotR3.html#MultiBody.Examples.Systems.RobotR3"
>MultiBody.Examples.Systems.RobotR3</A>.Components</H2>
<B>Library of components of the robot</B>
<P>
<A HREF="MultiBody_Examples_Systems_RobotR3_Components.html#MultiBody.Examples.Systems.RobotR3.Components.AxisBus"
><IMG SRC="MultiBody.Examples.Systems.RobotR3.Components.AxisBusI.png" ALT="MultiBody.Examples.Systems.RobotR3.Components.AxisBus" WIDTH=80  HEIGHT=80 ></A>
<A HREF="MultiBody_Examples_Systems_RobotR3_Components.html#MultiBody.Examples.Systems.RobotR3.Components.Bus"
><IMG SRC="MultiBody.Examples.Systems.RobotR3.Components.BusI.png" ALT="MultiBody.Examples.Systems.RobotR3.Components.Bus" WIDTH=80  HEIGHT=80 ></A>
<A HREF="MultiBody_Examples_Systems_RobotR3_Components.html#MultiBody.Examples.Systems.RobotR3.Components.PathPlanning"
><IMG SRC="MultiBody.Examples.Systems.RobotR3.Components.PathPlanningI.png" ALT="MultiBody.Examples.Systems.RobotR3.Components.PathPlanning" WIDTH=80  HEIGHT=80 ></A>
<A HREF="MultiBody_Examples_Systems_RobotR3_Components.html#MultiBody.Examples.Systems.RobotR3.Components.GearType1"
><IMG SRC="MultiBody.Examples.Systems.RobotR3.Components.GearType1I.png" ALT="MultiBody.Examples.Systems.RobotR3.Components.GearType1" WIDTH=80  HEIGHT=80 ></A>
<A HREF="MultiBody_Examples_Systems_RobotR3_Components.html#MultiBody.Examples.Systems.RobotR3.Components.GearType2"
><IMG SRC="MultiBody.Examples.Systems.RobotR3.Components.GearType2I.png" ALT="MultiBody.Examples.Systems.RobotR3.Components.GearType2" WIDTH=80  HEIGHT=80 ></A>
<A HREF="MultiBody_Examples_Systems_RobotR3_Components.html#MultiBody.Examples.Systems.RobotR3.Components.Motor"
><IMG SRC="MultiBody.Examples.Systems.RobotR3.Components.MotorI.png" ALT="MultiBody.Examples.Systems.RobotR3.Components.Motor" WIDTH=80  HEIGHT=80 ></A>
<A HREF="MultiBody_Examples_Systems_RobotR3_Components.html#MultiBody.Examples.Systems.RobotR3.Components.Controller"
><IMG SRC="MultiBody.Examples.Systems.RobotR3.Components.ControllerI.png" ALT="MultiBody.Examples.Systems.RobotR3.Components.Controller" WIDTH=80  HEIGHT=80 ></A>
<A HREF="MultiBody_Examples_Systems_RobotR3_Components.html#MultiBody.Examples.Systems.RobotR3.Components.AxisType1"
><IMG SRC="MultiBody.Examples.Systems.RobotR3.Components.AxisType1I.png" ALT="MultiBody.Examples.Systems.RobotR3.Components.AxisType1" WIDTH=80  HEIGHT=80 ></A>
<A HREF="MultiBody_Examples_Systems_RobotR3_Components.html#MultiBody.Examples.Systems.RobotR3.Components.AxisType2"
><IMG SRC="MultiBody.Examples.Systems.RobotR3.Components.AxisType2I.png" ALT="MultiBody.Examples.Systems.RobotR3.Components.AxisType2" WIDTH=80  HEIGHT=80 ></A>
<A HREF="MultiBody_Examples_Systems_RobotR3_Components.html#MultiBody.Examples.Systems.RobotR3.Components.MechanicalStructure"
><IMG SRC="MultiBody.Examples.Systems.RobotR3.Components.MechanicalStructureI.png" ALT="MultiBody.Examples.Systems.RobotR3.Components.MechanicalStructure" WIDTH=80  HEIGHT=80 ></A>
<A HREF="MultiBody_Examples_Systems_RobotR3_Components.html#MultiBody.Examples.Systems.RobotR3.Components.KinematicPTPc"
><IMG SRC="MultiBody.Examples.Systems.RobotR3.Components.KinematicPTPcI.png" ALT="MultiBody.Examples.Systems.RobotR3.Components.KinematicPTPc" WIDTH=80  HEIGHT=80 ></A>
<P><P>
<H3>Information</H3>
<PRE></pre>
<p>
This library contains the different components
of the r3 robot. Usually, there is no need to
use this library directly.
</p>
<pre></PRE><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Name</TH><TH>Description</TH></TR>
<TR><TD><A HREF="MultiBody_Examples_Systems_RobotR3_Components.html#MultiBody.Examples.Systems.RobotR3.Components.AxisBus"
>AxisBus</A>
</TD><TD>Data bus for one robot axis</TD></TR>
<TR><TD><A HREF="MultiBody_Examples_Systems_RobotR3_Components.html#MultiBody.Examples.Systems.RobotR3.Components.Bus"
>Bus</A>
</TD><TD>Data bus for all axes of robot</TD></TR>
<TR><TD><A HREF="MultiBody_Examples_Systems_RobotR3_Components.html#MultiBody.Examples.Systems.RobotR3.Components.PathPlanning"
>PathPlanning</A>
</TD><TD>Generate reference angles for fastest kinematic movement</TD></TR>
<TR><TD><A HREF="MultiBody_Examples_Systems_RobotR3_Components.html#MultiBody.Examples.Systems.RobotR3.Components.GearType1"
>GearType1</A>
</TD><TD>Motor inertia and gearbox model for r3 joints 1,2,3 </TD></TR>
<TR><TD><A HREF="MultiBody_Examples_Systems_RobotR3_Components.html#MultiBody.Examples.Systems.RobotR3.Components.GearType2"
>GearType2</A>
</TD><TD>Motor inertia and gearbox model for r3 joints 4,5,6  </TD></TR>
<TR><TD><A HREF="MultiBody_Examples_Systems_RobotR3_Components.html#MultiBody.Examples.Systems.RobotR3.Components.Motor"
>Motor</A>
</TD><TD>Motor model including current controller of r3 motors </TD></TR>
<TR><TD><A HREF="MultiBody_Examples_Systems_RobotR3_Components.html#MultiBody.Examples.Systems.RobotR3.Components.Controller"
>Controller</A>
</TD><TD>&nbsp;</TD></TR>
<TR><TD><A HREF="MultiBody_Examples_Systems_RobotR3_Components.html#MultiBody.Examples.Systems.RobotR3.Components.AxisType1"
>AxisType1</A>
</TD><TD>Axis model of the r3 joints 1,2,3 </TD></TR>
<TR><TD><A HREF="MultiBody_Examples_Systems_RobotR3_Components.html#MultiBody.Examples.Systems.RobotR3.Components.AxisType2"
>AxisType2</A>
</TD><TD>Axis model of the r3 joints 4,5,6 </TD></TR>
<TR><TD><A HREF="MultiBody_Examples_Systems_RobotR3_Components.html#MultiBody.Examples.Systems.RobotR3.Components.MechanicalStructure"
>MechanicalStructure</A>
</TD><TD>Model of the mechanical part of the r3 robot (without animation)</TD></TR>
<TR><TD><A HREF="MultiBody_Examples_Systems_RobotR3_Components.html#MultiBody.Examples.Systems.RobotR3.Components.KinematicPTPc"
>KinematicPTPc</A>
</TD><TD>Move as fast as possible along a distance within given kinematic constraints</TD></TR>
</TABLE>
<HR>
<!--[if supportFields]><span style='mso-element:field-begin'></span>
<span style='mso-spacerun:yes'></span>XE AxisType1<![endif]-->
<!--[if supportFields]><span style='mso-element:field-end'></span><![endif]-->
<H2><IMG SRC="MultiBody.Examples.Systems.RobotR3.Components.AxisType1I.png" ALT="MultiBody.Examples.Systems.RobotR3.Components.AxisType1" ALIGN=RIGHT BORDER=1 WIDTH=80  HEIGHT=80 >
<A NAME="MultiBody.Examples.Systems.RobotR3.Components.AxisType1"></A><A HREF="MultiBody_Examples_Systems_RobotR3_Components.html#MultiBody.Examples.Systems.RobotR3.Components"
>MultiBody.Examples.Systems.RobotR3.Components</A>.AxisType1</H2>
<B>Axis model of the r3 joints 1,2,3 </B><p>
<IMG SRC="MultiBody.Examples.Systems.RobotR3.Components.AxisType1D.png" ALT="MultiBody.Examples.Systems.RobotR3.Components.AxisType1">
<H3>Information</H3>
<PRE></pre>
<p>
The axis model consists of the <b>controller</b>, the <b>motor</b> including current
controller and the <b>gearbox</b> including gear elasticity and bearing friction.
The only difference to the axis model of joints 4,5,6 (= model axisType2) is
that elasticity and damping in the gear boxes are not neglected.
</p>
<p>
The input signals of this component are the desired angle and desired angular
velocity of the joint. The reference signals have to be "smooth" (position
has to be differentiable at least 2 times). Otherwise, the gear elasticity
leads to significant oscillations.
</p>
<p>
Default values of the parameters are given for the axis of joint 1.
</p>
<pre>
</PRE>
<H3>Parameters</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Name</TH><TH>Default</TH><TH>Description</TH></TR>
<TR><TD>kp</TD><TD>10</TD><TD> gain of position controller</TD></TR>
<TR><TD>ks</TD><TD>1</TD><TD> gain of speed controller</TD></TR>
<TR><TD>Ts</TD><TD>0.01</TD><TD> time constant of integrator of speed controller [s]</TD></TR>
<TR><TD>k</TD><TD>1.1616</TD><TD> gain of motor</TD></TR>
<TR><TD>w</TD><TD>4590</TD><TD> time constant of motor</TD></TR>
<TR><TD>D</TD><TD>0.6</TD><TD> damping constant of motor</TD></TR>
<TR><TD>J</TD><TD>0.0013</TD><TD> moment of inertia of motor [kg.m2]</TD></TR>
<TR><TD>ratio</TD><TD>-105</TD><TD> gear ratio</TD></TR>
<TR><TD>c</TD><TD>43</TD><TD> spring constant [N.m/rad]</TD></TR>
<TR><TD>cd</TD><TD>0.005</TD><TD> damper constant [N.m.s/rad]</TD></TR>
<TR><TD>Rv0</TD><TD>0.4</TD><TD> viscous friction torque at zero velocity in [Nm] [N.m]</TD></TR>
<TR><TD>Rv1</TD><TD>(0.13/160)</TD><TD> viscous friction coefficient in [Nms/rad] [N.m.s/rad]</TD></TR>
<TR><TD>peak</TD><TD>1</TD><TD> peak*Rv0 = maximum static friction torque (peak &gt;= 1)</TD></TR>
</TABLE>
<H3>Modelica definition</H3>
<PRE>
<font color="blue">model</font> AxisType1 <font color="darkgreen">&quot;Axis model of the r3 joints 1,2,3 &quot;</font>
  <font color="blue">parameter </font>Real kp=10 <font color="darkgreen">&quot;|Controller| gain of position controller&quot;</font>;
  <font color="blue">parameter </font>Real ks=1 <font color="darkgreen">&quot;|Controller| gain of speed controller&quot;</font>;
  <font color="blue">parameter </font><A HREF="../../Modelica/help/Modelica_SIunits.html#Modelica.SIunits.Time"
>SI.Time</A> Ts=0.01 <font color="darkgreen">
    &quot;|Controller| time constant of integrator of speed controller&quot;</font>;
  <font color="blue">parameter </font>Real k=1.1616 <font color="darkgreen">&quot;|Motor| gain of motor&quot;</font>;
  <font color="blue">parameter </font>Real w=4590 <font color="darkgreen">&quot;|Motor| time constant of motor&quot;</font>;
  <font color="blue">parameter </font>Real D=0.6 <font color="darkgreen">&quot;|Motor| damping constant of motor&quot;</font>;
  <font color="blue">parameter </font><A HREF="../../Modelica/help/Modelica_SIunits.html#Modelica.SIunits.Inertia"
>SI.Inertia</A> J=0.0013 <font color="darkgreen">&quot;|Motor| moment of inertia of motor&quot;</font>;
  <font color="blue">parameter </font>Real ratio=-105 <font color="darkgreen">&quot;|Gear| gear ratio&quot;</font>;
  <font color="blue">parameter </font>Real c(unit=&quot;N.m/rad&quot;) = 43 <font color="darkgreen">&quot;|Gear| spring constant&quot;</font>;
  <font color="blue">parameter </font>Real cd(unit=&quot;N.m.s/rad&quot;) = 0.005 <font color="darkgreen">&quot;|Gear| damper constant&quot;</font>;
  <font color="blue">parameter </font><A HREF="../../Modelica/help/Modelica_SIunits.html#Modelica.SIunits.Torque"
>SI.Torque</A> Rv0=0.4 <font color="darkgreen">
    &quot;|Gear| viscous friction torque at zero velocity in [Nm]&quot;</font>;
  <font color="blue">parameter </font>Real Rv1(unit=&quot;N.m.s/rad&quot;) = (0.13/160) <font color="darkgreen">
    &quot;|Gear| viscous friction coefficient in [Nms/rad]&quot;</font>;
  <font color="blue">parameter </font>Real peak=1 <font color="darkgreen">
    &quot;|Gear| peak*Rv0 = maximum static friction torque (peak &gt;= 1)&quot;</font>;
  <A HREF="../../Modelica/help/Modelica_SIunits.html#Modelica.SIunits.Angle"
>SI.Angle</A> phi_flange(stateSelect=StateSelect.prefer) = flange.phi;
  <A HREF="../../Modelica/help/Modelica_SIunits.html#Modelica.SIunits.AngularVelocity"
>SI.AngularVelocity</A> w_flange(stateSelect=StateSelect.prefer) = <font color="red">der</font>(
    phi_flange);
  <A HREF="../../Modelica/help/Modelica_SIunits.html#Modelica.SIunits.AngularAcceleration"
>SI.AngularAcceleration</A> a_flange=<font color="red">der</font>(w_flange);
  <font color="darkgreen"></font>
  <A HREF="../../Modelica/help/Modelica_Mechanics_Rotational_Interfaces.html#Modelica.Mechanics.Rotational.Interfaces.Flange_b"
>Modelica.Mechanics.Rotational.Interfaces.Flange_b</A> flange;
  <A HREF="MultiBody_Examples_Systems_RobotR3_Components.html#MultiBody.Examples.Systems.RobotR3.Components.GearType1"
>GearType1</A> gear(
    c=c,
    d=cd,
    Rv0=Rv0,
    Rv1=Rv1,
    peak=peak,
    i=ratio);
  <A HREF="MultiBody_Examples_Systems_RobotR3_Components.html#MultiBody.Examples.Systems.RobotR3.Components.Motor"
>Motor</A> motor(
    J=J,
    k=k,
    w=w,
    D=D);
  <A HREF="MultiBody_Examples_Systems_RobotR3_Components.html#MultiBody.Examples.Systems.RobotR3.Components.Controller"
>RobotR3.Components.Controller</A> controller(
    kp=kp,
    ks=ks,
    Ts=Ts,
    ratio=ratio);
  <A HREF="MultiBody_Examples_Systems_RobotR3_Components.html#MultiBody.Examples.Systems.RobotR3.Components.AxisBus"
>RobotR3.Components.AxisBus</A> bus;
  <A HREF="../../Modelica/help/Modelica_Blocks_Interfaces_BusAdaptors.html#Modelica.Blocks.Interfaces.BusAdaptors.SendReal"
>Modelica.Blocks.Interfaces.BusAdaptors.SendReal</A> angle;
  <A HREF="../../Modelica/help/Modelica_Mechanics_Rotational_Sensors.html#Modelica.Mechanics.Rotational.Sensors.AngleSensor"
>Modelica.Mechanics.Rotational.Sensors.AngleSensor</A> angleSensor;
  <A HREF="../../Modelica/help/Modelica_Mechanics_Rotational_Sensors.html#Modelica.Mechanics.Rotational.Sensors.SpeedSensor"
>Modelica.Mechanics.Rotational.Sensors.SpeedSensor</A> speedSensor;
  <A HREF="../../Modelica/help/Modelica_Blocks_Interfaces_BusAdaptors.html#Modelica.Blocks.Interfaces.BusAdaptors.SendReal"
>Modelica.Blocks.Interfaces.BusAdaptors.SendReal</A> speed;
  <A HREF="../../Modelica/help/Modelica_Mechanics_Rotational_Sensors.html#Modelica.Mechanics.Rotational.Sensors.AccSensor"
>Modelica.Mechanics.Rotational.Sensors.AccSensor</A> accSensor;
  <A HREF="../../Modelica/help/Modelica_Blocks_Interfaces_BusAdaptors.html#Modelica.Blocks.Interfaces.BusAdaptors.SendReal"
>Modelica.Blocks.Interfaces.BusAdaptors.SendReal</A> acceleration;
<font color="blue">initial </font><font color="blue">equation </font>
  <font color="darkgreen">// initialize in approximate steady state</font>
  phi_flange = bus.angle_ref;
  w_flange = bus.speed_ref;
  a_flange = 0;
<font color="blue">equation </font>
  <font color="red">connect</font>(controller.bus, bus);
  <font color="red">connect</font>(motor.bus, bus);
  <font color="red">connect</font>(gear.flange_b, flange);
  <font color="red">connect</font>(gear.flange_b, angleSensor.flange_a);
  <font color="red">connect</font>(gear.flange_b, speedSensor.flange_a);
  <font color="red">connect</font>(speedSensor.outPort, speed.inPort);
  <font color="red">connect</font>(angleSensor.outPort, angle.inPort);
  <font color="red">connect</font>(angle.toBus, bus.angle);
  <font color="red">connect</font>(speed.toBus, bus.speed);
  <font color="red">connect</font>(motor.flange_motor, gear.flange_a);
  <font color="red">connect</font>(gear.flange_b, accSensor.flange_a);
  <font color="red">connect</font>(accSensor.outPort, acceleration.inPort);
  <font color="red">connect</font>(acceleration.toBus, bus.acceleration);
<font color="blue">end </font>AxisType1;
</PRE>
<HR>
<!--[if supportFields]><span style='mso-element:field-begin'></span>
<span style='mso-spacerun:yes'></span>XE PathPlanning<![endif]-->
<!--[if supportFields]><span style='mso-element:field-end'></span><![endif]-->
<H2><IMG SRC="MultiBody.Examples.Systems.RobotR3.Components.PathPlanningI.png" ALT="MultiBody.Examples.Systems.RobotR3.Components.PathPlanning" ALIGN=RIGHT BORDER=1 WIDTH=80  HEIGHT=80 >
<A NAME="MultiBody.Examples.Systems.RobotR3.Components.PathPlanning"></A><A HREF="MultiBody_Examples_Systems_RobotR3_Components.html#MultiBody.Examples.Systems.RobotR3.Components"
>MultiBody.Examples.Systems.RobotR3.Components</A>.PathPlanning</H2>
<B>Generate reference angles for fastest kinematic movement</B><p>
<IMG SRC="MultiBody.Examples.Systems.RobotR3.Components.PathPlanningD.png" ALT="MultiBody.Examples.Systems.RobotR3.Components.PathPlanning">
<H3>Information</H3>
<PRE>Given
- start and end angles of every axis
- maximum speed of every axis
- maximum acceleration of every axis
this component computes the fastest movement under the
given constraints. This means, that:
1. Every axis accelerates with the maximum acceleration
   until the maximum speed is reached.
2. Drives with the maximum speed as long as possible.
3. Decelerates with the negative of the maximum acceleration
   until rest.
The acceleration, constant velocity and deceleration
phase are determined in such a way that the movement
starts form the start angles and ends at the end angles.
The output of this block are the computed angles and the
computed angular speeds as function of time. The ordering is:
   reference[1] = reference angle 1
            [2] = reference speed 1
            [3] = reference angle 2
            [4] = reference speed 2
                  ...
</PRE>
<H3>Parameters</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Name</TH><TH>Default</TH><TH>Description</TH></TR>
<TR><TD>naxis</TD><TD>6</TD><TD>number of driven axis</TD></TR>
<TR><TD>angleBegDeg[naxis]</TD><TD>zeros(naxis)</TD><TD>start angles [deg]</TD></TR>
<TR><TD>angleEndDeg[naxis]</TD><TD>ones(naxis)</TD><TD>end angles [deg]</TD></TR>
<TR><TD>speedMax[naxis]</TD><TD>fill(3, naxis)</TD><TD>maximum axis speed [rad/s]</TD></TR>
<TR><TD>accMax[naxis]</TD><TD>fill(2.5, naxis)</TD><TD>maximum axis acceleration [rad/s2]</TD></TR>
<TR><TD>startTime</TD><TD>0</TD><TD>start time of movement [s]</TD></TR>
<TR><TD>swingTime</TD><TD>0.5</TD><TD>additional time after reference motion is in rest before simulation is stopped [s]</TD></TR>
</TABLE>
<H3>Modelica definition</H3>
<PRE>
<font color="blue">model</font> PathPlanning <font color="darkgreen">
  &quot;Generate reference angles for fastest kinematic movement&quot;</font>
  <font color="darkgreen"></font>
  <font color="blue">import </font>SI = <A HREF="../../Modelica/help/Modelica_SIunits.html#Modelica.SIunits"
>Modelica.SIunits</A>;
  <font color="blue">import </font>Cv = <A HREF="../../Modelica/help/Modelica_SIunits_Conversions.html#Modelica.SIunits.Conversions"
>Modelica.SIunits.Conversions</A>;
  <font color="blue">parameter </font>Integer naxis=6 <font color="darkgreen">&quot;number of driven axis&quot;</font>;
  <font color="blue">parameter </font>Real angleBegDeg[naxis](unit=&quot;deg&quot;) = <font color="red">zeros</font>(naxis) <font color="darkgreen">&quot;start angles&quot;</font>;
  <font color="blue">parameter </font>Real angleEndDeg[naxis](unit=&quot;deg&quot;) = <font color="red">ones</font>(naxis) <font color="darkgreen">&quot;end angles&quot;</font>;
  <font color="blue">parameter </font><A HREF="../../Modelica/help/Modelica_SIunits.html#Modelica.SIunits.AngularVelocity"
>SI.AngularVelocity</A> speedMax[naxis]=<font color="red">fill</font>(3, naxis) <font color="darkgreen">&quot;maximum axis speed&quot;</font>;
  <font color="blue">parameter </font><A HREF="../../Modelica/help/Modelica_SIunits.html#Modelica.SIunits.AngularAcceleration"
>SI.AngularAcceleration</A> accMax[naxis]=<font color="red">fill</font>(2.5, naxis) <font color="darkgreen">
    &quot;maximum axis acceleration&quot;</font>;
  <font color="blue">parameter </font><A HREF="../../Modelica/help/Modelica_SIunits.html#Modelica.SIunits.Time"
>SI.Time</A> startTime=0 <font color="darkgreen">&quot;start time of movement&quot;</font>;
  <font color="blue">parameter </font><A HREF="../../Modelica/help/Modelica_SIunits.html#Modelica.SIunits.Time"
>SI.Time</A> swingTime=0.5 <font color="darkgreen">
    &quot;additional time after reference motion is in rest before simulation is stopped&quot;</font>;
  Boolean motion_ref <font color="darkgreen">&quot;True if reference motions of all axes is not in rest&quot;</font>;
  <font color="blue">final </font><font color="blue">parameter </font><A HREF="../../Modelica/help/Modelica_SIunits.html#Modelica.SIunits.Angle"
>SI.Angle</A> angleBeg[:]=<font color="red">Cv.from_deg</font>(angleBegDeg) <font color="darkgreen">&quot;start angles&quot;</font>;
  <font color="blue">final </font><font color="blue">parameter </font><A HREF="../../Modelica/help/Modelica_SIunits.html#Modelica.SIunits.Angle"
>SI.Angle</A> angleEnd[:]=<font color="red">Cv.from_deg</font>(angleEndDeg) <font color="darkgreen">&quot;end angles&quot;</font>;
  <font color="blue">constant </font>Real eps=100*Modelica.Constants.eps;
  <font color="darkgreen"></font>
<font color="blue">public </font>
  <A HREF="MultiBody_Examples_Systems_RobotR3_Components.html#MultiBody.Examples.Systems.RobotR3.Components.Bus"
>RobotR3.Components.Bus</A> bus(naxis=naxis);
  <A HREF="MultiBody_Examples_Systems_RobotR3_Components.html#MultiBody.Examples.Systems.RobotR3.Components.KinematicPTPc"
>RobotR3.Components.KinematicPTPc</A> kinematicPTP(
    q_end=angleEnd,
    qd_max=speedMax,
    qdd_max=accMax,
    startTime=startTime,
    q_begin=angleBeg);
<font color="blue">equation </font>
  motion_ref = time &lt;= kinematicPTP.endTime;
  <font color="blue">for </font>i<font color="blue"> in </font>1:naxis<font color="blue"> loop</font>
    bus.axis[i].angle_ref = kinematicPTP.q.signal[i];
    bus.axis[i].speed_ref = kinematicPTP.qd.signal[i];
    bus.axis[i].acceleration_ref = kinematicPTP.qdd.signal[i];
    bus.axis[i].motion_ref = <font color="blue">if </font><font color="red">abs</font>(angleBeg[i] - angleEnd[i]) &gt; eps<font color="blue"> then </font>
      motion_ref<font color="blue"> else </font>false;
  <font color="blue">end for</font>;
  <font color="darkgreen"></font>
  <font color="blue">when </font>time &gt;= kinematicPTP.endTime + swingTime<font color="blue"> then</font>
    <font color="red">terminate</font>(&quot;end condition reached&quot;);
  <font color="blue">end when</font>;
<font color="blue">end </font>PathPlanning;
</PRE>
<HR>
<!--[if supportFields]><span style='mso-element:field-begin'></span>
<span style='mso-spacerun:yes'></span>XE Bus<![endif]-->
<!--[if supportFields]><span style='mso-element:field-end'></span><![endif]-->
<H2><IMG SRC="MultiBody.Examples.Systems.RobotR3.Components.BusI.png" ALT="MultiBody.Examples.Systems.RobotR3.Components.Bus" ALIGN=RIGHT BORDER=1 WIDTH=80  HEIGHT=80 >
<A NAME="MultiBody.Examples.Systems.RobotR3.Components.Bus"></A><A HREF="MultiBody_Examples_Systems_RobotR3_Components.html#MultiBody.Examples.Systems.RobotR3.Components"
>MultiBody.Examples.Systems.RobotR3.Components</A>.Bus</H2>
<B>Data bus for all axes of robot</B><p>
<IMG SRC="MultiBody.Examples.Systems.RobotR3.Components.BusD.png" ALT="MultiBody.Examples.Systems.RobotR3.Components.Bus">
<H3>Information</H3>
<PRE></pre>
<p>Defines connector for signalbus.</p>
<pre>
</PRE>
<H3>Parameters</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Name</TH><TH>Default</TH><TH>Description</TH></TR>
<TR><TD>naxis</TD><TD>6</TD><TD>&nbsp;</TD></TR>
</TABLE>
<H3>Modelica definition</H3>
<PRE>
<font color="blue">connector</font> Bus <font color="darkgreen">&quot;Data bus for all axes of robot&quot;</font>
  <font color="blue">parameter </font>Integer naxis=6;
  <A HREF="MultiBody_Examples_Systems_RobotR3_Components.html#MultiBody.Examples.Systems.RobotR3.Components.AxisBus"
>AxisBus</A> axis[naxis];
  <font color="darkgreen"></font>
<font color="blue">end </font>Bus;
</PRE>
<HR>
<!--[if supportFields]><span style='mso-element:field-begin'></span>
<span style='mso-spacerun:yes'></span>XE MechanicalStructure<![endif]-->
<!--[if supportFields]><span style='mso-element:field-end'></span><![endif]-->
<H2><IMG SRC="MultiBody.Examples.Systems.RobotR3.Components.MechanicalStructureI.png" ALT="MultiBody.Examples.Systems.RobotR3.Components.MechanicalStructure" ALIGN=RIGHT BORDER=1 WIDTH=80  HEIGHT=80 >
<A NAME="MultiBody.Examples.Systems.RobotR3.Components.MechanicalStructure"></A><A HREF="MultiBody_Examples_Systems_RobotR3_Components.html#MultiBody.Examples.Systems.RobotR3.Components"
>MultiBody.Examples.Systems.RobotR3.Components</A>.MechanicalStructure</H2>
<B>Model of the mechanical part of the r3 robot (without animation)</B><p>
<IMG SRC="MultiBody.Examples.Systems.RobotR3.Components.MechanicalStructureD.png" ALT="MultiBody.Examples.Systems.RobotR3.Components.MechanicalStructure">
<H3>Information</H3>
<PRE></pre>
<p>
This model contains the mechanical components of the r3 robot
(multibody system).
</p>
<pre>
</PRE>
<H3>Parameters</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Name</TH><TH>Default</TH><TH>Description</TH></TR>
<TR><TD>animation</TD><TD>true</TD><TD>= true, if animation shall be enabled</TD></TR>
<TR><TD>mLoad</TD><TD>15</TD><TD>mass of load [kg]</TD></TR>
<TR><TD>rLoad[3]</TD><TD>{0,0.25,0}</TD><TD>distance from last flange to load mass&gt; [m]</TD></TR>
<TR><TD>g</TD><TD>9.81</TD><TD>gravity acceleration [m/s2]</TD></TR>
</TABLE>
<H3>Modelica definition</H3>
<PRE>
<font color="blue">model</font> MechanicalStructure <font color="darkgreen">
  &quot;Model of the mechanical part of the r3 robot (without animation)&quot;</font>
  <font color="darkgreen"></font>
  <font color="blue">parameter </font>Boolean animation=true <font color="darkgreen">&quot;= true, if animation shall be enabled&quot;</font>;
  <font color="blue">parameter </font><A HREF="../../Modelica/help/Modelica_SIunits.html#Modelica.SIunits.Mass"
>SI.Mass</A> mLoad=15 <font color="darkgreen">&quot;mass of load&quot;</font>;
  <font color="blue">parameter </font><A HREF="../../Modelica/help/Modelica_SIunits.html#Modelica.SIunits.Position"
>SI.Position</A> rLoad[3]={0,0.25,0} <font color="darkgreen">&quot;distance from last flange to load mass&gt;&quot;</font>;
  <font color="blue">parameter </font><A HREF="../../Modelica/help/Modelica_SIunits.html#Modelica.SIunits.Acceleration"
>SI.Acceleration</A> g=9.81 <font color="darkgreen">&quot;gravity acceleration&quot;</font>;
  <A HREF="../../Modelica/help/Modelica_SIunits.html#Modelica.SIunits.Angle"
>SI.Angle</A> q[6] <font color="darkgreen">&quot;joint angles&quot;</font>;
  <A HREF="../../Modelica/help/Modelica_SIunits.html#Modelica.SIunits.AngularVelocity"
>SI.AngularVelocity</A> qd[6] <font color="darkgreen">&quot;joint speeds&quot;</font>;
  <A HREF="../../Modelica/help/Modelica_SIunits.html#Modelica.SIunits.AngularAcceleration"
>SI.AngularAcceleration</A> qdd[6] <font color="darkgreen">&quot;joint accelerations&quot;</font>;
  <A HREF="../../Modelica/help/Modelica_SIunits.html#Modelica.SIunits.Torque"
>SI.Torque</A> tau[6] <font color="darkgreen">&quot;joint driving torques&quot;</font>;
  <font color="darkgreen">//r0={0,0.351,0},</font>
  <font color="darkgreen"></font>
  <A HREF="../../Modelica/help/Modelica_Mechanics_Rotational_Interfaces.html#Modelica.Mechanics.Rotational.Interfaces.Flange_a"
>Modelica.Mechanics.Rotational.Interfaces.Flange_a</A> axis1;
  <A HREF="../../Modelica/help/Modelica_Mechanics_Rotational_Interfaces.html#Modelica.Mechanics.Rotational.Interfaces.Flange_a"
>Modelica.Mechanics.Rotational.Interfaces.Flange_a</A> axis2;
  <A HREF="../../Modelica/help/Modelica_Mechanics_Rotational_Interfaces.html#Modelica.Mechanics.Rotational.Interfaces.Flange_a"
>Modelica.Mechanics.Rotational.Interfaces.Flange_a</A> axis3;
  <A HREF="../../Modelica/help/Modelica_Mechanics_Rotational_Interfaces.html#Modelica.Mechanics.Rotational.Interfaces.Flange_a"
>Modelica.Mechanics.Rotational.Interfaces.Flange_a</A> axis4;
  <A HREF="../../Modelica/help/Modelica_Mechanics_Rotational_Interfaces.html#Modelica.Mechanics.Rotational.Interfaces.Flange_a"
>Modelica.Mechanics.Rotational.Interfaces.Flange_a</A> axis5;
  <A HREF="../../Modelica/help/Modelica_Mechanics_Rotational_Interfaces.html#Modelica.Mechanics.Rotational.Interfaces.Flange_a"
>Modelica.Mechanics.Rotational.Interfaces.Flange_a</A> axis6;
  <font color="blue">inner </font><A HREF="MultiBody.html#MultiBody.World"
>MultiBody.World</A> world(
    g=(g)*<font color="red">MultiBody.Frames.length</font>(({0,-1,0})),
    n={0,-1,0},
    animateWorld=false,
    animateGravity=false);
  <A HREF="MultiBody_Joints.html#MultiBody.Joints.ActuatedRevolute"
>MultiBody.Joints.ActuatedRevolute</A> r1(n={0,1,0});
  <A HREF="MultiBody_Joints.html#MultiBody.Joints.ActuatedRevolute"
>MultiBody.Joints.ActuatedRevolute</A> r2(n={1,0,0});
  <A HREF="MultiBody_Joints.html#MultiBody.Joints.ActuatedRevolute"
>MultiBody.Joints.ActuatedRevolute</A> r3(n={1,0,0});
  <A HREF="MultiBody_Joints.html#MultiBody.Joints.ActuatedRevolute"
>MultiBody.Joints.ActuatedRevolute</A> r4(n={0,1,0});
  <A HREF="MultiBody_Joints.html#MultiBody.Joints.ActuatedRevolute"
>MultiBody.Joints.ActuatedRevolute</A> r5(n={1,0,0});
  <A HREF="MultiBody_Joints.html#MultiBody.Joints.ActuatedRevolute"
>MultiBody.Joints.ActuatedRevolute</A> r6(n={0,1,0});
  <A HREF="MultiBody_Parts.html#MultiBody.Parts.BodyShape"
>MultiBody.Parts.BodyShape</A> b0(
    r={0,0.351,0},
    shapeType=&quot;0&quot;,
    r_shape={0,0,0},
    lengthDirection={1,0,0},
    widthDirection={0,1,0},
    length=0.225,
    width=0.3,
    height=0.3,
    color={0,0,255},
    animation=animation,
    animateSphere=false);
  <A HREF="MultiBody_Parts.html#MultiBody.Parts.BodyShape"
>MultiBody.Parts.BodyShape</A> b1(
    r={0,0.324,0.3},
    I_22=1.16,
    shapeType=&quot;1&quot;,
    lengthDirection={1,0,0},
    widthDirection={0,1,0},
    length=0.25,
    width=0.15,
    height=0.2,
    animation=animation,
    animateSphere=false,
    color={255,0,0});
  <A HREF="MultiBody_Parts.html#MultiBody.Parts.BodyShape"
>MultiBody.Parts.BodyShape</A> b2(
    r={0,0.65,0},
    r_CM={0.172,0.205,0},
    m=56.5,
    I_11=2.58,
    I_22=0.64,
    I_33=2.73,
    I_21=-0.46,
    shapeType=&quot;2&quot;,
    r_shape={0,0,0},
    lengthDirection={1,0,0},
    widthDirection={0,1,0},
    length=0.5,
    width=0.2,
    height=0.15,
    animation=animation,
    animateSphere=false,
    color={255,178,0});
  <A HREF="MultiBody_Parts.html#MultiBody.Parts.BodyShape"
>MultiBody.Parts.BodyShape</A> b3(
    r={0,0.414,-0.155},
    r_CM={0.064,-0.034,0},
    m=26.4,
    I_11=0.279,
    I_22=0.245,
    I_33=0.413,
    I_21=-0.070,
    shapeType=&quot;3&quot;,
    r_shape={0,0,0},
    lengthDirection={1,0,0},
    widthDirection={0,1,0},
    length=0.15,
    width=0.15,
    height=0.15,
    animation=animation,
    animateSphere=false,
    color={255,0,0});
  <A HREF="MultiBody_Parts.html#MultiBody.Parts.BodyShape"
>MultiBody.Parts.BodyShape</A> b4(
    r={0,0.186,0},
    r_CM={0,0,0},
    m=28.7,
    I_11=1.67,
    I_22=0.081,
    I_33=1.67,
    shapeType=&quot;4&quot;,
    r_shape={0,0,0},
    lengthDirection={1,0,0},
    widthDirection={0,1,0},
    length=0.73,
    width=0.1,
    height=0.1,
    animation=animation,
    animateSphere=false,
    color={255,178,0});
  <A HREF="MultiBody_Parts.html#MultiBody.Parts.BodyShape"
>MultiBody.Parts.BodyShape</A> b5(
    r={0,0.125,0},
    r_CM={0,0,0},
    m=5.2,
    I_11=1.25,
    I_22=0.81,
    I_33=1.53,
    shapeType=&quot;5&quot;,
    r_shape={0,0,0},
    lengthDirection={1,0,0},
    widthDirection={0,1,0},
    length=0.225,
    width=0.075,
    height=0.1,
    animation=animation,
    animateSphere=false,
    color={0,0,255});
  <A HREF="MultiBody_Parts.html#MultiBody.Parts.BodyShape"
>MultiBody.Parts.BodyShape</A> b6(
    r={0,0,0},
    r_CM={0.05,0.05,0.05},
    m=0.5,
    shapeType=&quot;6&quot;,
    r_shape={0,0,0},
    lengthDirection={1,0,0},
    widthDirection={0,1,0},
    animation=animation,
    animateSphere=false,
    color={0,0,255});
  <A HREF="MultiBody_Parts.html#MultiBody.Parts.BodyShape"
>MultiBody.Parts.BodyShape</A> load(
    r_CM=rLoad,
    m=mLoad,
    r_shape={0,0,0},
    widthDirection={1,0,0},
    width=0.05,
    height=0.05,
    color={255,0,0},
    lengthDirection=rLoad,
    length=<font color="red">MultiBody.Frames.length</font>(rLoad));
<font color="blue">equation </font>
  <font color="red">connect</font>(r6.frame_b, b6.frame_a);
  q = {r1.phi,r2.phi,r3.phi,r4.phi,r5.phi,r6.phi};
  qd = <font color="red">der</font>(q);
  qdd = <font color="red">der</font>(qd);
  tau = {r1.axis.tau,r2.axis.tau,r3.axis.tau,r4.axis.tau,r5.axis.tau,r6.axis.
    tau};
  <font color="red">connect</font>(load.frame_a, b6.frame_b);
  <font color="red">connect</font>(world.frame_b, b0.frame_a);
  <font color="red">connect</font>(b0.frame_b, r1.frame_a);
  <font color="red">connect</font>(b1.frame_b, r2.frame_a);
  <font color="red">connect</font>(r1.frame_b, b1.frame_a);
  <font color="red">connect</font>(r2.frame_b, b2.frame_a);
  <font color="red">connect</font>(b2.frame_b, r3.frame_a);
  <font color="red">connect</font>(r2.axis, axis2);
  <font color="red">connect</font>(r1.axis, axis1);
  <font color="red">connect</font>(r3.frame_b, b3.frame_a);
  <font color="red">connect</font>(b3.frame_b, r4.frame_a);
  <font color="red">connect</font>(r3.axis, axis3);
  <font color="red">connect</font>(r4.axis, axis4);
  <font color="red">connect</font>(r4.frame_b, b4.frame_a);
  <font color="red">connect</font>(b4.frame_b, r5.frame_a);
  <font color="red">connect</font>(r5.axis, axis5);
  <font color="red">connect</font>(r5.frame_b, b5.frame_a);
  <font color="red">connect</font>(b5.frame_b, r6.frame_a);
  <font color="red">connect</font>(r6.axis, axis6);
<font color="blue">end </font>MechanicalStructure;
</PRE>
<HR>
<!--[if supportFields]><span style='mso-element:field-begin'></span>
<span style='mso-spacerun:yes'></span>XE AxisType2<![endif]-->
<!--[if supportFields]><span style='mso-element:field-end'></span><![endif]-->
<H2><IMG SRC="MultiBody.Examples.Systems.RobotR3.Components.AxisType2I.png" ALT="MultiBody.Examples.Systems.RobotR3.Components.AxisType2" ALIGN=RIGHT BORDER=1 WIDTH=80  HEIGHT=80 >
<A NAME="MultiBody.Examples.Systems.RobotR3.Components.AxisType2"></A><A HREF="MultiBody_Examples_Systems_RobotR3_Components.html#MultiBody.Examples.Systems.RobotR3.Components"
>MultiBody.Examples.Systems.RobotR3.Components</A>.AxisType2</H2>
<B>Axis model of the r3 joints 4,5,6 </B><p>
<IMG SRC="MultiBody.Examples.Systems.RobotR3.Components.AxisType2D.png" ALT="MultiBody.Examples.Systems.RobotR3.Components.AxisType2">
<H3>Information</H3>
<PRE></pre>
<p>
The axis model consists of the <b>controller</b>, the <b>motor</b> including current
controller and the <b>gearbox</b> including gear elasticity and bearing friction.
The only difference to the axis model of joints 4,5,6 (= model axisType2) is
that elasticity and damping in the gear boxes are not neglected.
</p>
<p>
The input signals of this component are the desired angle and desired angular
velocity of the joint. The reference signals have to be "smooth" (position
has to be differentiable at least 2 times). Otherwise, the gear elasticity
leads to significant oscillations.
</p>
<p>
Default values of the parameters are given for the axis of joint 1.
</p>
<pre>
</PRE>
<H3>Parameters</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Name</TH><TH>Default</TH><TH>Description</TH></TR>
<TR><TD>kp</TD><TD>10</TD><TD> gain of position controller</TD></TR>
<TR><TD>ks</TD><TD>1</TD><TD> gain of speed controller</TD></TR>
<TR><TD>Ts</TD><TD>0.01</TD><TD> time constant of integrator of speed controller [s]</TD></TR>
<TR><TD>k</TD><TD>1.1616</TD><TD> gain of motor</TD></TR>
<TR><TD>w</TD><TD>4590</TD><TD> time constant of motor</TD></TR>
<TR><TD>D</TD><TD>0.6</TD><TD> damping constant of motor</TD></TR>
<TR><TD>J</TD><TD>0.0013</TD><TD> moment of inertia of motor [kg.m2]</TD></TR>
<TR><TD>ratio</TD><TD>-105</TD><TD> gear ratio</TD></TR>
<TR><TD>Rv0</TD><TD>0.4</TD><TD> viscous friction torque at zero velocity in [Nm] [N.m]</TD></TR>
<TR><TD>Rv1</TD><TD>(0.13/160)</TD><TD> viscous friction coefficient in [Nms/rad] [N.m.s/rad]</TD></TR>
<TR><TD>peak</TD><TD>1</TD><TD> peak*Rv0 = maximum static friction torque (peak &gt;= 1)</TD></TR>
</TABLE>
<H3>Modelica definition</H3>
<PRE>
<font color="blue">model</font> AxisType2 <font color="darkgreen">&quot;Axis model of the r3 joints 4,5,6 &quot;</font>
  <font color="blue">parameter </font>Real kp=10 <font color="darkgreen">&quot;|Controller| gain of position controller&quot;</font>;
  <font color="blue">parameter </font>Real ks=1 <font color="darkgreen">&quot;|Controller| gain of speed controller&quot;</font>;
  <font color="blue">parameter </font><A HREF="../../Modelica/help/Modelica_SIunits.html#Modelica.SIunits.Time"
>SI.Time</A> Ts=0.01 <font color="darkgreen">
    &quot;|Controller| time constant of integrator of speed controller&quot;</font>;
  <font color="blue">parameter </font>Real k=1.1616 <font color="darkgreen">&quot;|Motor| gain of motor&quot;</font>;
  <font color="blue">parameter </font>Real w=4590 <font color="darkgreen">&quot;|Motor| time constant of motor&quot;</font>;
  <font color="blue">parameter </font>Real D=0.6 <font color="darkgreen">&quot;|Motor| damping constant of motor&quot;</font>;
  <font color="blue">parameter </font><A HREF="../../Modelica/help/Modelica_SIunits.html#Modelica.SIunits.Inertia"
>SI.Inertia</A> J=0.0013 <font color="darkgreen">&quot;|Motor| moment of inertia of motor&quot;</font>;
  <font color="blue">parameter </font>Real ratio=-105 <font color="darkgreen">&quot;|Gear| gear ratio&quot;</font>;
  <font color="blue">parameter </font><A HREF="../../Modelica/help/Modelica_SIunits.html#Modelica.SIunits.Torque"
>SI.Torque</A> Rv0=0.4 <font color="darkgreen">
    &quot;|Gear| viscous friction torque at zero velocity in [Nm]&quot;</font>;
  <font color="blue">parameter </font>Real Rv1(unit=&quot;N.m.s/rad&quot;) = (0.13/160) <font color="darkgreen">
    &quot;|Gear| viscous friction coefficient in [Nms/rad]&quot;</font>;
  <font color="blue">parameter </font>Real peak=1 <font color="darkgreen">
    &quot;|Gear| peak*Rv0 = maximum static friction torque (peak &gt;= 1)&quot;</font>;
  <A HREF="../../Modelica/help/Modelica_SIunits.html#Modelica.SIunits.Angle"
>SI.Angle</A> phi_flange(stateSelect=StateSelect.prefer) = flange.phi;
  <A HREF="../../Modelica/help/Modelica_SIunits.html#Modelica.SIunits.AngularVelocity"
>SI.AngularVelocity</A> w_flange(stateSelect=StateSelect.prefer) = <font color="red">der</font>(
    phi_flange);
  <A HREF="../../Modelica/help/Modelica_SIunits.html#Modelica.SIunits.AngularAcceleration"
>SI.AngularAcceleration</A> a_flange=<font color="red">der</font>(w_flange);
  <font color="darkgreen"></font>
  <A HREF="../../Modelica/help/Modelica_Mechanics_Rotational_Interfaces.html#Modelica.Mechanics.Rotational.Interfaces.Flange_b"
>Modelica.Mechanics.Rotational.Interfaces.Flange_b</A> flange;
  <A HREF="MultiBody_Examples_Systems_RobotR3_Components.html#MultiBody.Examples.Systems.RobotR3.Components.GearType2"
>GearType2</A> gear(
    Rv0=Rv0,
    Rv1=Rv1,
    peak=peak,
    i=ratio);
  <A HREF="MultiBody_Examples_Systems_RobotR3_Components.html#MultiBody.Examples.Systems.RobotR3.Components.Motor"
>Motor</A> motor(
    J=J,
    k=k,
    w=w,
    D=D);
  <A HREF="MultiBody_Examples_Systems_RobotR3_Components.html#MultiBody.Examples.Systems.RobotR3.Components.Controller"
>RobotR3.Components.Controller</A> controller(
    kp=kp,
    ks=ks,
    Ts=Ts,
    ratio=ratio);
  <A HREF="MultiBody_Examples_Systems_RobotR3_Components.html#MultiBody.Examples.Systems.RobotR3.Components.AxisBus"
>RobotR3.Components.AxisBus</A> bus;
  <A HREF="../../Modelica/help/Modelica_Blocks_Interfaces_BusAdaptors.html#Modelica.Blocks.Interfaces.BusAdaptors.SendReal"
>Modelica.Blocks.Interfaces.BusAdaptors.SendReal</A> angle;
  <A HREF="../../Modelica/help/Modelica_Mechanics_Rotational_Sensors.html#Modelica.Mechanics.Rotational.Sensors.AngleSensor"
>Modelica.Mechanics.Rotational.Sensors.AngleSensor</A> angleSensor;
  <A HREF="../../Modelica/help/Modelica_Mechanics_Rotational_Sensors.html#Modelica.Mechanics.Rotational.Sensors.SpeedSensor"
>Modelica.Mechanics.Rotational.Sensors.SpeedSensor</A> speedSensor;
  <A HREF="../../Modelica/help/Modelica_Blocks_Interfaces_BusAdaptors.html#Modelica.Blocks.Interfaces.BusAdaptors.SendReal"
>Modelica.Blocks.Interfaces.BusAdaptors.SendReal</A> speed;
  <A HREF="../../Modelica/help/Modelica_Blocks_Interfaces_BusAdaptors.html#Modelica.Blocks.Interfaces.BusAdaptors.SendReal"
>Modelica.Blocks.Interfaces.BusAdaptors.SendReal</A> acceleration;
  <A HREF="../../Modelica/help/Modelica_Mechanics_Rotational_Sensors.html#Modelica.Mechanics.Rotational.Sensors.AccSensor"
>Modelica.Mechanics.Rotational.Sensors.AccSensor</A> accSensor;
<font color="blue">initial </font><font color="blue">equation </font>
  <font color="darkgreen">// initialize in approximate steady state</font>
  phi_flange = bus.angle_ref;
  w_flange = bus.speed_ref;
  a_flange = 0;
<font color="blue">equation </font>
  <font color="red">connect</font>(controller.bus, bus);
  <font color="red">connect</font>(motor.bus, bus);
  <font color="red">connect</font>(gear.flange_b, flange);
  <font color="red">connect</font>(gear.flange_b, angleSensor.flange_a);
  <font color="red">connect</font>(gear.flange_b, speedSensor.flange_a);
  <font color="red">connect</font>(speedSensor.outPort, speed.inPort);
  <font color="red">connect</font>(angleSensor.outPort, angle.inPort);
  <font color="red">connect</font>(angle.toBus, bus.angle);
  <font color="red">connect</font>(speed.toBus, bus.speed);
  <font color="red">connect</font>(motor.flange_motor, gear.flange_a);
  <font color="red">connect</font>(gear.flange_b, accSensor.flange_a);
  <font color="red">connect</font>(accSensor.outPort, acceleration.inPort);
  <font color="red">connect</font>(acceleration.toBus, bus.acceleration);
<font color="blue">end </font>AxisType2;
</PRE>
<HR>
<!--[if supportFields]><span style='mso-element:field-begin'></span>
<span style='mso-spacerun:yes'></span>XE AxisBus<![endif]-->
<!--[if supportFields]><span style='mso-element:field-end'></span><![endif]-->
<H2><IMG SRC="MultiBody.Examples.Systems.RobotR3.Components.AxisBusI.png" ALT="MultiBody.Examples.Systems.RobotR3.Components.AxisBus" ALIGN=RIGHT BORDER=1 WIDTH=80  HEIGHT=80 >
<A NAME="MultiBody.Examples.Systems.RobotR3.Components.AxisBus"></A><A HREF="MultiBody_Examples_Systems_RobotR3_Components.html#MultiBody.Examples.Systems.RobotR3.Components"
>MultiBody.Examples.Systems.RobotR3.Components</A>.AxisBus</H2>
<B>Data bus for one robot axis</B><p>
<IMG SRC="MultiBody.Examples.Systems.RobotR3.Components.AxisBusD.png" ALT="MultiBody.Examples.Systems.RobotR3.Components.AxisBus">
<H3>Information</H3>
<PRE></pre>
<p>Defines connector for signalbus.</p>
<pre>
</PRE>
<H3>Modelica definition</H3>
<PRE>
<font color="blue">connector</font> AxisBus <font color="darkgreen">&quot;Data bus for one robot axis&quot;</font>
  <font color="blue">import </font><A HREF="../../Modelica/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces"
>Modelica.Blocks.Interfaces</A>;
  <A HREF="../../Modelica/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.BooleanPort"
>Interfaces.BooleanPort</A> motion_ref <font color="darkgreen">
    &quot;true, if reference motion is not in rest&quot;</font>;
  <A HREF="../../Modelica/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealPort"
>Interfaces.RealPort</A> angle_ref(<font color="blue">redeclare </font><font color="blue">type</font> SignalType = <A HREF="../../Modelica/help/Modelica_SIunits.html#Modelica.SIunits.Angle"
>SI.Angle</A>) <font color="darkgreen">&quot;reference angle of axis flange&quot;</font>;
  <A HREF="../../Modelica/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealPort"
>Interfaces.RealPort</A> angle(<font color="blue">redeclare </font><font color="blue">type</font> SignalType = <A HREF="../../Modelica/help/Modelica_SIunits.html#Modelica.SIunits.Angle"
>SI.Angle</A>) <font color="darkgreen">&quot;angle of axis flange&quot;</font>;
  <A HREF="../../Modelica/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealPort"
>Interfaces.RealPort</A> speed_ref(<font color="blue">redeclare </font><font color="blue">type</font> SignalType = <A HREF="../../Modelica/help/Modelica_SIunits.html#Modelica.SIunits.AngularVelocity"
>SI.AngularVelocity</A>) <font color="darkgreen">&quot;reference speed of axis flange&quot;</font>;
  <A HREF="../../Modelica/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealPort"
>Interfaces.RealPort</A> speed(<font color="blue">redeclare </font><font color="blue">type</font> SignalType = <A HREF="../../Modelica/help/Modelica_SIunits.html#Modelica.SIunits.AngularVelocity"
>SI.AngularVelocity</A>) <font color="darkgreen">&quot;speed of axis flange&quot;</font>;
  <A HREF="../../Modelica/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealPort"
>Interfaces.RealPort</A> acceleration_ref(<font color="blue">redeclare </font><font color="blue">type</font> SignalType = <A HREF="../../Modelica/help/Modelica_SIunits.html#Modelica.SIunits.AngularAcceleration"
>SI.AngularAcceleration</A>) <font color="darkgreen">&quot;reference acceleration of axis flange&quot;</font>;
  <A HREF="../../Modelica/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealPort"
>Interfaces.RealPort</A> acceleration(<font color="blue">redeclare </font><font color="blue">type</font> SignalType = <A HREF="../../Modelica/help/Modelica_SIunits.html#Modelica.SIunits.AngularAcceleration"
>SI.AngularAcceleration</A>) <font color="darkgreen">&quot;acceleration of axis flange&quot;</font>;
  <A HREF="../../Modelica/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealPort"
>Interfaces.RealPort</A> current_ref(<font color="blue">redeclare </font><font color="blue">type</font> SignalType = <A HREF="../../Modelica/help/Modelica_SIunits.html#Modelica.SIunits.Current"
>SI.Current</A>) <font color="darkgreen">&quot;reference current of motor&quot;</font>;
  <A HREF="../../Modelica/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealPort"
>Interfaces.RealPort</A> current(<font color="blue">redeclare </font><font color="blue">type</font> SignalType = <A HREF="../../Modelica/help/Modelica_SIunits.html#Modelica.SIunits.Current"
>SI.Current</A>) <font color="darkgreen">&quot;current of motor&quot;</font>;
  <A HREF="../../Modelica/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealPort"
>Interfaces.RealPort</A> motorAngle(<font color="blue">redeclare </font><font color="blue">type</font> SignalType = <A HREF="../../Modelica/help/Modelica_SIunits.html#Modelica.SIunits.Angle"
>SI.Angle</A>) <font color="darkgreen">&quot;angle of motor flange&quot;</font>;
  <A HREF="../../Modelica/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealPort"
>Interfaces.RealPort</A> motorSpeed(<font color="blue">redeclare </font><font color="blue">type</font> SignalType = <A HREF="../../Modelica/help/Modelica_SIunits.html#Modelica.SIunits.AngularVelocity"
>SI.AngularVelocity</A>) <font color="darkgreen">&quot;speed of motor flange&quot;</font>;
<font color="blue">end </font>AxisBus;
</PRE>
<HR>
<!--[if supportFields]><span style='mso-element:field-begin'></span>
<span style='mso-spacerun:yes'></span>XE GearType1<![endif]-->
<!--[if supportFields]><span style='mso-element:field-end'></span><![endif]-->
<H2><IMG SRC="MultiBody.Examples.Systems.RobotR3.Components.GearType1I.png" ALT="MultiBody.Examples.Systems.RobotR3.Components.GearType1" ALIGN=RIGHT BORDER=1 WIDTH=80  HEIGHT=80 >
<A NAME="MultiBody.Examples.Systems.RobotR3.Components.GearType1"></A><A HREF="MultiBody_Examples_Systems_RobotR3_Components.html#MultiBody.Examples.Systems.RobotR3.Components"
>MultiBody.Examples.Systems.RobotR3.Components</A>.GearType1</H2>
<B>Motor inertia and gearbox model for r3 joints 1,2,3 </B><p>
<IMG SRC="MultiBody.Examples.Systems.RobotR3.Components.GearType1D.png" ALT="MultiBody.Examples.Systems.RobotR3.Components.GearType1">
<H3>Information</H3>
<PRE>
Models the gearbox used in the first three joints with all its effects,
like elasticity and friction.
Coulomb friction is approximated by a friction element acting
at the &quot;motor&quot;-side. In reality, bearing friction should be
also incorporated at the driven side of the gearbox. However,
this would require considerable more effort for the measurement
of the friction parameters.
Default values for all parameters are given for joint 1.
Model relativeStates is used to define the relative angle
and relative angular velocity across the spring (=gear elasticity)
as state variables. The reason is, that a default initial
value of zero of these states makes always sense.
If the absolute angle and the absolute angular velocity of model
Jmotor would be used as states, and the load angle (= joint angle of
robot) is NOT zero, one has always to ensure that the initial values
of the motor angle and of the joint angle are modified correspondingly.
Otherwise, the spring has an unrealistic deflection at initial time.
Since relative quantities are used as state variables, this simplifies
the definition of initial values considerably.
</PRE>
<H3>Parameters</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Name</TH><TH>Default</TH><TH>Description</TH></TR>
<TR><TD>i</TD><TD>-105</TD><TD>gear ratio</TD></TR>
<TR><TD>c</TD><TD>43</TD><TD>spring constant [N.m/rad]</TD></TR>
<TR><TD>d</TD><TD>0.005</TD><TD>damper constant [N.m.s/rad]</TD></TR>
<TR><TD>Rv0</TD><TD>0.4</TD><TD>viscous friction torque at zero velocity [N.m]</TD></TR>
<TR><TD>Rv1</TD><TD>(0.13/160)</TD><TD>viscous friction coefficient (R=Rv0+Rv1*abs(qd)) [N.m.s/rad]</TD></TR>
<TR><TD>peak</TD><TD>1</TD><TD>peak*Rv0 = maximum static friction torque (peak &gt;= 1)</TD></TR>
</TABLE>
<H3>Modelica definition</H3>
<PRE>
<font color="blue">model</font> GearType1 <font color="darkgreen">
  &quot;Motor inertia and gearbox model for r3 joints 1,2,3 &quot;</font>
  <font color="blue">extends </font><A HREF="../../Modelica/help/Modelica_Mechanics_Rotational_Interfaces.html#Modelica.Mechanics.Rotational.Interfaces.TwoFlanges"
>Modelica.Mechanics.Rotational.Interfaces.TwoFlanges</A>;
  <font color="blue">parameter </font>Real i=-105 <font color="darkgreen">&quot;gear ratio&quot;</font>;
  <font color="blue">parameter </font>Real c(unit=&quot;N.m/rad&quot;) = 43 <font color="darkgreen">&quot;spring constant&quot;</font>;
  <font color="blue">parameter </font>Real d(unit=&quot;N.m.s/rad&quot;) = 0.005 <font color="darkgreen">&quot;damper constant&quot;</font>;
  <font color="blue">parameter </font><A HREF="../../Modelica/help/Modelica_SIunits.html#Modelica.SIunits.Torque"
>SI.Torque</A> Rv0=0.4 <font color="darkgreen">&quot;viscous friction torque at zero velocity&quot;</font>;
  <font color="blue">parameter </font>Real Rv1(unit=&quot;N.m.s/rad&quot;) = (0.13/160) <font color="darkgreen">
    &quot;viscous friction coefficient (R=Rv0+Rv1*abs(qd))&quot;</font>;
  <font color="blue">parameter </font>Real peak=1 <font color="darkgreen">&quot;peak*Rv0 = maximum static friction torque (peak &gt;= 1)&quot;</font>;
  <A HREF="../../Modelica/help/Modelica_SIunits.html#Modelica.SIunits.AngularAcceleration"
>SI.AngularAcceleration</A> a_rel=<font color="red">der</font>(spring.w_rel) <font color="darkgreen">
    &quot;Relative angular acceleration of spring&quot;</font>;
  <font color="darkgreen"></font>
  <font color="darkgreen"></font>
  <A HREF="../../Modelica/help/Modelica_Mechanics_Rotational.html#Modelica.Mechanics.Rotational.IdealGear"
>Modelica.Mechanics.Rotational.IdealGear</A> gear(ratio=i);
  <A HREF="../../Modelica/help/Modelica_Mechanics_Rotational.html#Modelica.Mechanics.Rotational.SpringDamper"
>Modelica.Mechanics.Rotational.SpringDamper</A> spring(c=c, d=d);
  <A HREF="../../Modelica/help/Modelica_Mechanics_Rotational.html#Modelica.Mechanics.Rotational.BearingFriction"
>Modelica.Mechanics.Rotational.BearingFriction</A> bearingFriction(tau_pos=[0,
        Rv0; 1, Rv0 + Rv1]);
<font color="blue">equation </font>
  <font color="red">connect</font>(spring.flange_b, gear.flange_a);
  <font color="red">connect</font>(bearingFriction.flange_b, spring.flange_a);
  <font color="red">connect</font>(gear.flange_b, flange_b);
  <font color="red">connect</font>(bearingFriction.flange_a, flange_a);
<font color="blue">initial </font><font color="blue">equation </font>
  spring.w_rel = 0;
  a_rel = 0;
<font color="blue">end </font>GearType1;
</PRE>
<HR>
<!--[if supportFields]><span style='mso-element:field-begin'></span>
<span style='mso-spacerun:yes'></span>XE GearType2<![endif]-->
<!--[if supportFields]><span style='mso-element:field-end'></span><![endif]-->
<H2><IMG SRC="MultiBody.Examples.Systems.RobotR3.Components.GearType2I.png" ALT="MultiBody.Examples.Systems.RobotR3.Components.GearType2" ALIGN=RIGHT BORDER=1 WIDTH=80  HEIGHT=80 >
<A NAME="MultiBody.Examples.Systems.RobotR3.Components.GearType2"></A><A HREF="MultiBody_Examples_Systems_RobotR3_Components.html#MultiBody.Examples.Systems.RobotR3.Components"
>MultiBody.Examples.Systems.RobotR3.Components</A>.GearType2</H2>
<B>Motor inertia and gearbox model for r3 joints 4,5,6  </B><p>
<IMG SRC="MultiBody.Examples.Systems.RobotR3.Components.GearType2D.png" ALT="MultiBody.Examples.Systems.RobotR3.Components.GearType2">
<H3>Information</H3>
<PRE>The elasticity and damping in the gearboxes of the outermost
three joints of the robot is neglected.
Default values for all parameters are given for joint 4.
</PRE>
<H3>Parameters</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Name</TH><TH>Default</TH><TH>Description</TH></TR>
<TR><TD>i</TD><TD>-99</TD><TD>gear ratio</TD></TR>
<TR><TD>Rv0</TD><TD>21.8</TD><TD>viscous friction torque at zero velocity [N.m]</TD></TR>
<TR><TD>Rv1</TD><TD>9.8</TD><TD>viscous friction coefficient in [Nms/rad] (R=Rv0+Rv1*abs(qd))</TD></TR>
<TR><TD>peak</TD><TD>(26.7/21.8)</TD><TD>peak*Rv0 = maximum static friction torque (peak &gt;= 1)</TD></TR>
</TABLE>
<H3>Modelica definition</H3>
<PRE>
<font color="blue">model</font> GearType2 <font color="darkgreen">
  &quot;Motor inertia and gearbox model for r3 joints 4,5,6  &quot;</font>
  <font color="blue">extends </font><A HREF="../../Modelica/help/Modelica_Mechanics_Rotational_Interfaces.html#Modelica.Mechanics.Rotational.Interfaces.TwoFlanges"
>Modelica.Mechanics.Rotational.Interfaces.TwoFlanges</A>;
  <font color="blue">parameter </font>Real i=-99 <font color="darkgreen">&quot;gear ratio&quot;</font>;
  <font color="blue">parameter </font><A HREF="../../Modelica/help/Modelica_SIunits.html#Modelica.SIunits.Torque"
>SI.Torque</A> Rv0=21.8 <font color="darkgreen">&quot;viscous friction torque at zero velocity&quot;</font>;
  <font color="blue">parameter </font>Real Rv1=9.8 <font color="darkgreen">
    &quot;viscous friction coefficient in [Nms/rad] (R=Rv0+Rv1*abs(qd))&quot;</font>;
  <font color="blue">parameter </font>Real peak=(26.7/21.8) <font color="darkgreen">
    &quot;peak*Rv0 = maximum static friction torque (peak &gt;= 1)&quot;</font>;
  <font color="darkgreen"></font>
  <A HREF="../../Modelica/help/Modelica_Mechanics_Rotational.html#Modelica.Mechanics.Rotational.IdealGear"
>Modelica.Mechanics.Rotational.IdealGear</A> gear(ratio=i);
  <A HREF="../../Modelica/help/Modelica_Mechanics_Rotational.html#Modelica.Mechanics.Rotational.BearingFriction"
>Modelica.Mechanics.Rotational.BearingFriction</A> bearingFriction(tau_pos=[0,
        Rv0; 1, Rv0 + Rv1], peak=peak);
<font color="blue">equation </font>
  <font color="red">connect</font>(gear.flange_b, bearingFriction.flange_a);
  <font color="red">connect</font>(bearingFriction.flange_b, flange_b);
  <font color="red">connect</font>(gear.flange_a, flange_a);
<font color="blue">end </font>GearType2;
</PRE>
<HR>
<!--[if supportFields]><span style='mso-element:field-begin'></span>
<span style='mso-spacerun:yes'></span>XE Motor<![endif]-->
<!--[if supportFields]><span style='mso-element:field-end'></span><![endif]-->
<H2><IMG SRC="MultiBody.Examples.Systems.RobotR3.Components.MotorI.png" ALT="MultiBody.Examples.Systems.RobotR3.Components.Motor" ALIGN=RIGHT BORDER=1 WIDTH=80  HEIGHT=80 >
<A NAME="MultiBody.Examples.Systems.RobotR3.Components.Motor"></A><A HREF="MultiBody_Examples_Systems_RobotR3_Components.html#MultiBody.Examples.Systems.RobotR3.Components"
>MultiBody.Examples.Systems.RobotR3.Components</A>.Motor</H2>
<B>Motor model including current controller of r3 motors </B><p>
<IMG SRC="MultiBody.Examples.Systems.RobotR3.Components.MotorD.png" ALT="MultiBody.Examples.Systems.RobotR3.Components.Motor">
<H3>Information</H3>
<PRE> Default values are given for the motor of joint 1.
The input of the motor is the desired current
(the actual current is proportional to the torque
produced by the motor).
</PRE>
<H3>Parameters</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Name</TH><TH>Default</TH><TH>Description</TH></TR>
<TR><TD>J</TD><TD>0.0013</TD><TD>moment of inertia of motor [kg.m2]</TD></TR>
<TR><TD>k</TD><TD>1.1616</TD><TD>gain of motor</TD></TR>
<TR><TD>w</TD><TD>4590</TD><TD>time constant of motor</TD></TR>
<TR><TD>D</TD><TD>0.6</TD><TD>damping constant of motor</TD></TR>
<TR><TD>w_max</TD><TD>315</TD><TD>maximum speed of motor [rad/s]</TD></TR>
<TR><TD>i_max</TD><TD>9</TD><TD>maximum current of motor [A]</TD></TR>
</TABLE>
<H3>Modelica definition</H3>
<PRE>
<font color="blue">model</font> Motor <font color="darkgreen">&quot;Motor model including current controller of r3 motors &quot;</font>
  <font color="blue">extends </font><A HREF="../../Modelica/help/Modelica_Icons.html#Modelica.Icons.MotorIcon"
>Modelica.Icons.MotorIcon</A>;
  <font color="blue">parameter </font><A HREF="../../Modelica/help/Modelica_SIunits.html#Modelica.SIunits.Inertia"
>SI.Inertia</A> J=0.0013 <font color="darkgreen">&quot;moment of inertia of motor&quot;</font>;
  <font color="blue">parameter </font>Real k=1.1616 <font color="darkgreen">&quot;gain of motor&quot;</font>;
  <font color="blue">parameter </font>Real w=4590 <font color="darkgreen">&quot;time constant of motor&quot;</font>;
  <font color="blue">parameter </font>Real D=0.6 <font color="darkgreen">&quot;damping constant of motor&quot;</font>;
  <font color="blue">parameter </font><A HREF="../../Modelica/help/Modelica_SIunits.html#Modelica.SIunits.AngularVelocity"
>SI.AngularVelocity</A> w_max=315 <font color="darkgreen">&quot;maximum speed of motor&quot;</font>;
  <font color="blue">parameter </font><A HREF="../../Modelica/help/Modelica_SIunits.html#Modelica.SIunits.Current"
>SI.Current</A> i_max=9 <font color="darkgreen">&quot;maximum current of motor&quot;</font>;
  <font color="darkgreen"></font>
  <font color="darkgreen"></font>
  <A HREF="../../Modelica/help/Modelica_Mechanics_Rotational_Interfaces.html#Modelica.Mechanics.Rotational.Interfaces.Flange_b"
>Modelica.Mechanics.Rotational.Interfaces.Flange_b</A> flange_motor;
  <A HREF="../../Modelica/help/Modelica_Electrical_Analog_Sources.html#Modelica.Electrical.Analog.Sources.SignalVoltage"
>Modelica.Electrical.Analog.Sources.SignalVoltage</A> Vs;
  <A HREF="../../Modelica/help/Modelica_Electrical_Analog_Ideal.html#Modelica.Electrical.Analog.Ideal.IdealOpAmp"
>Modelica.Electrical.Analog.Ideal.IdealOpAmp</A> diff;
  <A HREF="../../Modelica/help/Modelica_Electrical_Analog_Ideal.html#Modelica.Electrical.Analog.Ideal.IdealOpAmp"
>Modelica.Electrical.Analog.Ideal.IdealOpAmp</A> power;
  <A HREF="../../Modelica/help/Modelica_Electrical_Analog_Basic.html#Modelica.Electrical.Analog.Basic.EMF"
>Modelica.Electrical.Analog.Basic.EMF</A> emf(k=k);
  <A HREF="../../Modelica/help/Modelica_Electrical_Analog_Basic.html#Modelica.Electrical.Analog.Basic.Inductor"
>Modelica.Electrical.Analog.Basic.Inductor</A> La(L=(250/(2*D*w)));
  <A HREF="../../Modelica/help/Modelica_Electrical_Analog_Basic.html#Modelica.Electrical.Analog.Basic.Resistor"
>Modelica.Electrical.Analog.Basic.Resistor</A> Ra(R=250);
  <A HREF="../../Modelica/help/Modelica_Electrical_Analog_Basic.html#Modelica.Electrical.Analog.Basic.Resistor"
>Modelica.Electrical.Analog.Basic.Resistor</A> Rd2(R=100);
  <A HREF="../../Modelica/help/Modelica_Electrical_Analog_Basic.html#Modelica.Electrical.Analog.Basic.Capacitor"
>Modelica.Electrical.Analog.Basic.Capacitor</A> C(C=0.004*D/w);
  <A HREF="../../Modelica/help/Modelica_Electrical_Analog_Ideal.html#Modelica.Electrical.Analog.Ideal.IdealOpAmp"
>Modelica.Electrical.Analog.Ideal.IdealOpAmp</A> OpI;
  <A HREF="../../Modelica/help/Modelica_Electrical_Analog_Basic.html#Modelica.Electrical.Analog.Basic.Resistor"
>Modelica.Electrical.Analog.Basic.Resistor</A> Rd1(R=100);
  <A HREF="../../Modelica/help/Modelica_Electrical_Analog_Basic.html#Modelica.Electrical.Analog.Basic.Resistor"
>Modelica.Electrical.Analog.Basic.Resistor</A> Ri(R=10);
  <A HREF="../../Modelica/help/Modelica_Electrical_Analog_Basic.html#Modelica.Electrical.Analog.Basic.Resistor"
>Modelica.Electrical.Analog.Basic.Resistor</A> Rp1(R=200);
  <A HREF="../../Modelica/help/Modelica_Electrical_Analog_Basic.html#Modelica.Electrical.Analog.Basic.Resistor"
>Modelica.Electrical.Analog.Basic.Resistor</A> Rp2(R=50);
  <A HREF="../../Modelica/help/Modelica_Electrical_Analog_Basic.html#Modelica.Electrical.Analog.Basic.Resistor"
>Modelica.Electrical.Analog.Basic.Resistor</A> Rd4(R=100);
  <A HREF="../../Modelica/help/Modelica_Electrical_Analog_Sources.html#Modelica.Electrical.Analog.Sources.SignalVoltage"
>Modelica.Electrical.Analog.Sources.SignalVoltage</A> hall2;
  <A HREF="../../Modelica/help/Modelica_Electrical_Analog_Basic.html#Modelica.Electrical.Analog.Basic.Resistor"
>Modelica.Electrical.Analog.Basic.Resistor</A> Rd3(R=100);
  <A HREF="../../Modelica/help/Modelica_Electrical_Analog_Basic.html#Modelica.Electrical.Analog.Basic.Ground"
>Modelica.Electrical.Analog.Basic.Ground</A> g1;
  <A HREF="../../Modelica/help/Modelica_Electrical_Analog_Basic.html#Modelica.Electrical.Analog.Basic.Ground"
>Modelica.Electrical.Analog.Basic.Ground</A> g2;
  <A HREF="../../Modelica/help/Modelica_Electrical_Analog_Basic.html#Modelica.Electrical.Analog.Basic.Ground"
>Modelica.Electrical.Analog.Basic.Ground</A> g3;
  <A HREF="../../Modelica/help/Modelica_Electrical_Analog_Sensors.html#Modelica.Electrical.Analog.Sensors.CurrentSensor"
>Modelica.Electrical.Analog.Sensors.CurrentSensor</A> hall1;
  <A HREF="../../Modelica/help/Modelica_Electrical_Analog_Basic.html#Modelica.Electrical.Analog.Basic.Ground"
>Modelica.Electrical.Analog.Basic.Ground</A> g4;
  <A HREF="../../Modelica/help/Modelica_Electrical_Analog_Basic.html#Modelica.Electrical.Analog.Basic.Ground"
>Modelica.Electrical.Analog.Basic.Ground</A> g5;
  <A HREF="../../Modelica/help/Modelica_Mechanics_Rotational_Sensors.html#Modelica.Mechanics.Rotational.Sensors.AngleSensor"
>Modelica.Mechanics.Rotational.Sensors.AngleSensor</A> phi;
  <A HREF="../../Modelica/help/Modelica_Mechanics_Rotational_Sensors.html#Modelica.Mechanics.Rotational.Sensors.SpeedSensor"
>Modelica.Mechanics.Rotational.Sensors.SpeedSensor</A> speed;
  <A HREF="../../Modelica/help/Modelica_Mechanics_Rotational.html#Modelica.Mechanics.Rotational.Inertia"
>Modelica.Mechanics.Rotational.Inertia</A> Jmotor(J=J);
  <A HREF="MultiBody_Examples_Systems_RobotR3_Components.html#MultiBody.Examples.Systems.RobotR3.Components.AxisBus"
>RobotR3.Components.AxisBus</A> bus;
  <A HREF="../../Modelica/help/Modelica_Blocks_Interfaces_BusAdaptors.html#Modelica.Blocks.Interfaces.BusAdaptors.ReceiveReal"
>Modelica.Blocks.Interfaces.BusAdaptors.ReceiveReal</A> current_ref;
  <A HREF="../../Modelica/help/Modelica_Blocks_Interfaces_BusAdaptors.html#Modelica.Blocks.Interfaces.BusAdaptors.SendReal"
>Modelica.Blocks.Interfaces.BusAdaptors.SendReal</A> motorSpeed;
  <A HREF="../../Modelica/help/Modelica_Blocks_Interfaces_BusAdaptors.html#Modelica.Blocks.Interfaces.BusAdaptors.SendReal"
>Modelica.Blocks.Interfaces.BusAdaptors.SendReal</A> motorAngle;
  <A HREF="../../Modelica/help/Modelica_Blocks_Interfaces_BusAdaptors.html#Modelica.Blocks.Interfaces.BusAdaptors.SendReal"
>Modelica.Blocks.Interfaces.BusAdaptors.SendReal</A> current;
<font color="blue">equation </font>
  <font color="red">connect</font>(La.n, emf.p);
  <font color="red">connect</font>(Ra.n, La.p);
  <font color="red">connect</font>(Rd2.n, diff.n1);
  <font color="red">connect</font>(C.n, OpI.p2);
  <font color="red">connect</font>(OpI.p2, power.p1);
  <font color="red">connect</font>(Vs.p, Rd2.p);
  <font color="red">connect</font>(diff.n1, Rd1.p);
  <font color="red">connect</font>(Rd1.n, diff.p2);
  <font color="red">connect</font>(diff.p2, Ri.p);
  <font color="red">connect</font>(Ri.n, OpI.n1);
  <font color="red">connect</font>(OpI.n1, C.p);
  <font color="red">connect</font>(power.n1, Rp1.p);
  <font color="red">connect</font>(power.p2, Rp1.n);
  <font color="red">connect</font>(Rp1.p, Rp2.p);
  <font color="red">connect</font>(power.p2, Ra.p);
  <font color="red">connect</font>(Rd3.p, hall2.p);
  <font color="red">connect</font>(Rd3.n, diff.p1);
  <font color="red">connect</font>(Rd3.n, Rd4.p);
  <font color="red">connect</font>(Vs.n, g1.p);
  <font color="red">connect</font>(g2.p, hall2.n);
  <font color="red">connect</font>(Rd4.n, g3.p);
  <font color="red">connect</font>(g3.p, OpI.p1);
  <font color="red">connect</font>(hall1.outPort, hall2.inPort);
  <font color="red">connect</font>(g5.p, Rp2.n);
  <font color="red">connect</font>(emf.n, hall1.p);
  <font color="red">connect</font>(hall1.n, g4.p);
  <font color="red">connect</font>(emf.flange_b, phi.flange_a);
  <font color="red">connect</font>(emf.flange_b, speed.flange_a);
  <font color="red">connect</font>(OpI.n2, power.n2);
  <font color="red">connect</font>(OpI.p1, OpI.n2);
  <font color="red">connect</font>(OpI.p1, diff.n2);
  <font color="red">connect</font>(Jmotor.flange_a, emf.flange_b);
  <font color="red">connect</font>(Jmotor.flange_b, flange_motor);
  <font color="red">connect</font>(speed.outPort, motorSpeed.inPort);
  <font color="red">connect</font>(phi.outPort, motorAngle.inPort);
  <font color="red">connect</font>(motorSpeed.toBus, bus.motorSpeed);
  <font color="red">connect</font>(motorAngle.toBus, bus.motorAngle);
  <font color="red">connect</font>(current_ref.fromBus, bus.current_ref);
  <font color="red">connect</font>(current_ref.outPort, Vs.inPort);
<font color="blue">initial </font><font color="blue">equation </font>
  <font color="darkgreen">// initialize motor in steady state</font>
  <font color="red">der</font>(C.v) = 0;
  <font color="red">der</font>(La.i) = 0;
<font color="blue">equation </font>
  <font color="red">connect</font>(hall1.outPort, current.inPort);
  <font color="red">connect</font>(current.toBus, bus.current);
<font color="blue">end </font>Motor;
</PRE>
<HR>
<!--[if supportFields]><span style='mso-element:field-begin'></span>
<span style='mso-spacerun:yes'></span>XE Controller<![endif]-->
<!--[if supportFields]><span style='mso-element:field-end'></span><![endif]-->
<H2><IMG SRC="MultiBody.Examples.Systems.RobotR3.Components.ControllerI.png" ALT="MultiBody.Examples.Systems.RobotR3.Components.Controller" ALIGN=RIGHT BORDER=1 WIDTH=80  HEIGHT=80 >
<A NAME="MultiBody.Examples.Systems.RobotR3.Components.Controller"></A><A HREF="MultiBody_Examples_Systems_RobotR3_Components.html#MultiBody.Examples.Systems.RobotR3.Components"
>MultiBody.Examples.Systems.RobotR3.Components</A>.Controller</H2>
<IMG SRC="MultiBody.Examples.Systems.RobotR3.Components.ControllerD.png" ALT="MultiBody.Examples.Systems.RobotR3.Components.Controller">
<H3>Parameters</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Name</TH><TH>Default</TH><TH>Description</TH></TR>
<TR><TD>kp</TD><TD>10</TD><TD>gain of position controller</TD></TR>
<TR><TD>ks</TD><TD>1</TD><TD>gain of speed controller</TD></TR>
<TR><TD>Ts</TD><TD>0.01</TD><TD>time constant of integrator of speed controller [s]</TD></TR>
<TR><TD>ratio</TD><TD>1</TD><TD>gear ratio of gearbox</TD></TR>
</TABLE>
<H3>Modelica definition</H3>
<PRE>
<font color="blue">model</font> Controller
  <font color="blue">parameter </font>Real kp=10 <font color="darkgreen">&quot;gain of position controller&quot;</font>;
  <font color="blue">parameter </font>Real ks=1 <font color="darkgreen">&quot;gain of speed controller&quot;</font>;
  <font color="blue">parameter </font><A HREF="../../Modelica/help/Modelica_SIunits.html#Modelica.SIunits.Time"
>SI.Time</A> Ts=0.01 <font color="darkgreen">&quot;time constant of integrator of speed controller&quot;</font>;
  <font color="blue">parameter </font>Real ratio=1 <font color="darkgreen">&quot;gear ratio of gearbox&quot;</font>;
  <font color="darkgreen"></font>
  <A HREF="../../Modelica/help/Modelica_Blocks_Math.html#Modelica.Blocks.Math.Gain"
>Modelica.Blocks.Math.Gain</A> gain1(k={ratio});
  <A HREF="../../Modelica/help/Modelica_Blocks_Continuous.html#Modelica.Blocks.Continuous.PI"
>Modelica.Blocks.Continuous.PI</A> PI(k={ks}, T={Ts});
  <A HREF="../../Modelica/help/Modelica_Blocks_Math.html#Modelica.Blocks.Math.Feedback"
>Modelica.Blocks.Math.Feedback</A> feedback1;
  <A HREF="../../Modelica/help/Modelica_Blocks_Math.html#Modelica.Blocks.Math.Gain"
>Modelica.Blocks.Math.Gain</A> P(k={kp});
  <A HREF="../../Modelica/help/Modelica_Blocks_Math.html#Modelica.Blocks.Math.Add3"
>Modelica.Blocks.Math.Add3</A> add3(k3=-1);
  <A HREF="../../Modelica/help/Modelica_Blocks_Math.html#Modelica.Blocks.Math.Gain"
>Modelica.Blocks.Math.Gain</A> gain2(k={ratio});
  <A HREF="MultiBody_Examples_Systems_RobotR3_Components.html#MultiBody.Examples.Systems.RobotR3.Components.AxisBus"
>RobotR3.Components.AxisBus</A> bus;
  <A HREF="../../Modelica/help/Modelica_Blocks_Interfaces_BusAdaptors.html#Modelica.Blocks.Interfaces.BusAdaptors.SendReal"
>Modelica.Blocks.Interfaces.BusAdaptors.SendReal</A> current_ref;
  <A HREF="../../Modelica/help/Modelica_Blocks_Interfaces_BusAdaptors.html#Modelica.Blocks.Interfaces.BusAdaptors.ReceiveReal"
>Modelica.Blocks.Interfaces.BusAdaptors.ReceiveReal</A> angle_ref;
  <A HREF="../../Modelica/help/Modelica_Blocks_Interfaces_BusAdaptors.html#Modelica.Blocks.Interfaces.BusAdaptors.ReceiveReal"
>Modelica.Blocks.Interfaces.BusAdaptors.ReceiveReal</A> speed_ref;
  <A HREF="../../Modelica/help/Modelica_Blocks_Interfaces_BusAdaptors.html#Modelica.Blocks.Interfaces.BusAdaptors.ReceiveReal"
>Modelica.Blocks.Interfaces.BusAdaptors.ReceiveReal</A> motorAngle;
  <A HREF="../../Modelica/help/Modelica_Blocks_Interfaces_BusAdaptors.html#Modelica.Blocks.Interfaces.BusAdaptors.ReceiveReal"
>Modelica.Blocks.Interfaces.BusAdaptors.ReceiveReal</A> motorSpeed;
<font color="blue">equation </font>
  <font color="red">connect</font>(gain1.outPort, feedback1.inPort1);
  <font color="red">connect</font>(feedback1.outPort, P.inPort);
  <font color="red">connect</font>(P.outPort, add3.inPort2);
  <font color="red">connect</font>(gain2.outPort, add3.inPort1);
  <font color="red">connect</font>(speed_ref.outPort, gain2.inPort);
  <font color="red">connect</font>(motorAngle.outPort, feedback1.inPort2);
  <font color="red">connect</font>(motorSpeed.outPort, add3.inPort3);
  <font color="red">connect</font>(current_ref.toBus, bus.current_ref);
  <font color="red">connect</font>(angle_ref.fromBus, bus.angle_ref);
  <font color="red">connect</font>(speed_ref.fromBus, bus.speed_ref);
  <font color="red">connect</font>(motorAngle.fromBus, bus.motorAngle);
  <font color="red">connect</font>(motorSpeed.fromBus, bus.motorSpeed);
  <font color="red">connect</font>(angle_ref.outPort, gain1.inPort);
  <font color="red">connect</font>(add3.outPort, PI.inPort);
  <font color="red">connect</font>(PI.outPort, current_ref.inPort);
<font color="blue">end </font>Controller;
</PRE>
<HR>
<!--[if supportFields]><span style='mso-element:field-begin'></span>
<span style='mso-spacerun:yes'></span>XE KinematicPTPc<![endif]-->
<!--[if supportFields]><span style='mso-element:field-end'></span><![endif]-->
<H2><IMG SRC="MultiBody.Examples.Systems.RobotR3.Components.KinematicPTPcI.png" ALT="MultiBody.Examples.Systems.RobotR3.Components.KinematicPTPc" ALIGN=RIGHT BORDER=1 WIDTH=80  HEIGHT=80 >
<A NAME="MultiBody.Examples.Systems.RobotR3.Components.KinematicPTPc"></A><A HREF="MultiBody_Examples_Systems_RobotR3_Components.html#MultiBody.Examples.Systems.RobotR3.Components"
>MultiBody.Examples.Systems.RobotR3.Components</A>.KinematicPTPc</H2>
<B>Move as fast as possible along a distance within given kinematic constraints</B><p>
<IMG SRC="MultiBody.Examples.Systems.RobotR3.Components.KinematicPTPcD.png" ALT="MultiBody.Examples.Systems.RobotR3.Components.KinematicPTPc">
<H3>Information</H3>
<PRE>
</pre>
<p>
The goal is to move as <b>fast</b> as possible along a distance
<b>deltaq</b>
under given <b>kinematical constraints</b>. The distance can be a positional or
angular range. In robotics such a movement is called <b>PTP</b> (Point-To-Point).
This source block generates the <b>acceleration</b> qdd of this signal
as output. After integrating the output two times, the position q is
obtained. The signal is constructed in such a way that it is not possible
to move faster, given the <b>maximally</b> allowed <b>velocity</b> qd_max and
the <b>maximally</b> allowed <b>acceleration</b> qdd_max.
</p>
<p>
If several distances are given (vector deltaq has more than 1 element),
an acceleration output vector is constructed such that all signals
are in the same periods in the acceleration, constant velocity
and deceleration phase. This means that only one of the signals
is at its limits whereas the others are sychnronized in such a way
that the end point is reached at the same time instant.
</p>
<p>
This element is useful to generate a reference signal for a controller
which controls a drive train or in combination with model
Modelica.Mechanics.Rotational.<b>Accelerate</b> to drive
a flange according to a given acceleration.
</p>
<p><b>Release Notes:</b></p>
<ul>
<li><i>June 27, 2001</i>
       by Bernhard Bachmann.<br>
       Bug fixed that element is also correct if startTime is not zero.</li>
<li><i>Nov. 3, 1999</i>
       by <a href="http://www.op.dlr.de/~otter/">Martin Otter</a>:<br>
       Vectorized and moved from Rotational to Blocks.Sources.</li>
<li><i>June 29, 1999</i>
       by <a href="http://www.op.dlr.de/~otter/">Martin Otter</a>:<br>
       realized.</li>
</ul>
<pre>
</PRE>
<H3>Parameters</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Name</TH><TH>Default</TH><TH>Description</TH></TR>
<TR><TD>q_begin[:]</TD><TD>{0}</TD><TD>Start position</TD></TR>
<TR><TD>q_end[:]</TD><TD>{1}</TD><TD>End position</TD></TR>
<TR><TD>qd_max[:]</TD><TD>{1}</TD><TD>Maximum velocities der(q)</TD></TR>
<TR><TD>qdd_max[:]</TD><TD>{1}</TD><TD>Maximum accelerations der(qd)</TD></TR>
<TR><TD>startTime</TD><TD>0</TD><TD>Time instant at which movement starts [s]</TD></TR>
</TABLE>
<H3>Modelica definition</H3>
<PRE>
<font color="blue">block</font> KinematicPTPc <font color="darkgreen">
  &quot;Move as fast as possible along a distance within given kinematic constraints&quot;</font>

  <font color="darkgreen"></font>
  <font color="blue">parameter </font>Real q_begin[:]={0} <font color="darkgreen">&quot;Start position&quot;</font>;
  <font color="blue">parameter </font>Real q_end[:]={1} <font color="darkgreen">&quot;End position&quot;</font>;
  <font color="blue">parameter </font>Real qd_max[:](<font color="blue">final </font>min=Modelica.Constants.SMALL) = {1} <font color="darkgreen">
    &quot;Maximum velocities der(q)&quot;</font>;
  <font color="blue">parameter </font>Real qdd_max[:](<font color="blue">final </font>min=Modelica.Constants.SMALL) = {1} <font color="darkgreen">
    &quot;Maximum accelerations der(qd)&quot;</font>;
  <font color="blue">parameter </font><A HREF="../../Modelica/help/Modelica_SIunits.html#Modelica.SIunits.Time"
>SI.Time</A> startTime=0 <font color="darkgreen">&quot;Time instant at which movement starts&quot;</font>;
  <font color="darkgreen"></font>
  <font color="blue">extends </font><A HREF="../../Modelica/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.BlockIcon"
>Modelica.Blocks.Interfaces.BlockIcon</A>;
  <font color="blue">final </font><font color="blue">parameter </font>Integer nout=<font color="red">max</font>([<font color="red">size</font>(q_begin, 1); <font color="red">size</font>(q_end, 1); <font color="red">size</font>(
      qd_max, 1); <font color="red">size</font>(qdd_max, 1)]);
  <font color="blue">output </font><A HREF="../../Modelica/help/Modelica_SIunits.html#Modelica.SIunits.Time"
>SI.Time</A> endTime <font color="darkgreen">&quot;Time instant at which movement stops&quot;</font>;
  <font color="darkgreen"></font>
<font color="blue">protected </font>
  <font color="blue">parameter </font>Real p_q_begin[nout]=(<font color="blue">if </font><font color="red">size</font>(q_begin, 1) == 1<font color="blue"> then </font><font color="red">ones</font>(nout)*
      q_begin[1]<font color="blue"> else </font>q_begin);
  <font color="blue">parameter </font>Real p_q_end[nout]=(<font color="blue">if </font><font color="red">size</font>(q_end, 1) == 1<font color="blue"> then </font><font color="red">ones</font>(nout)*q_end[1]<font color="blue">
       else </font>q_end);
  <font color="blue">parameter </font>Real p_qd_max[nout]=(<font color="blue">if </font><font color="red">size</font>(qd_max, 1) == 1<font color="blue"> then </font><font color="red">ones</font>(nout)*qd_max[
      1]<font color="blue"> else </font>qd_max);
  <font color="blue">parameter </font>Real p_qdd_max[nout]=(<font color="blue">if </font><font color="red">size</font>(qdd_max, 1) == 1<font color="blue"> then </font><font color="red">ones</font>(nout)*
      qdd_max[1]<font color="blue"> else </font>qdd_max);
  <font color="blue">parameter </font>Real p_deltaq[nout]=p_q_end - p_q_begin;
  <font color="blue">constant </font>Real eps=10*Modelica.Constants.eps;
  Real sd_max_inv;
  Real sdd_max_inv;
  Real sd_max;
  Real sdd_max;
  Real sdd;
  Real aux1[nout];
  Real aux2[nout];
  <A HREF="../../Modelica/help/Modelica_SIunits.html#Modelica.SIunits.Time"
>SI.Time</A> Ta1;
  <A HREF="../../Modelica/help/Modelica_SIunits.html#Modelica.SIunits.Time"
>SI.Time</A> Ta2;
  <A HREF="../../Modelica/help/Modelica_SIunits.html#Modelica.SIunits.Time"
>SI.Time</A> Tv;
  <A HREF="../../Modelica/help/Modelica_SIunits.html#Modelica.SIunits.Time"
>SI.Time</A> Te;
  Boolean noWphase;
  <A HREF="../../Modelica/help/Modelica_SIunits.html#Modelica.SIunits.Time"
>SI.Time</A> Ta1s;
  <A HREF="../../Modelica/help/Modelica_SIunits.html#Modelica.SIunits.Time"
>SI.Time</A> Ta2s;
  <A HREF="../../Modelica/help/Modelica_SIunits.html#Modelica.SIunits.Time"
>SI.Time</A> Tvs;
  <A HREF="../../Modelica/help/Modelica_SIunits.html#Modelica.SIunits.Time"
>SI.Time</A> Tes;
  Real sd_max2;
  Real s1;
  Real s2;
  Real s3;
  Real s;
  Real sd;
  Real constraintResidue;
  Real r_s;
  Real r_sd;
  Real r_sdd;
  Real constraintResidue_d;
  Real constraintResidue_dd;
<font color="blue">public </font>
  <A HREF="../../Modelica/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.OutPort"
>Modelica.Blocks.Interfaces.OutPort</A> q(n=nout);
  <A HREF="../../Modelica/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.OutPort"
>Modelica.Blocks.Interfaces.OutPort</A> qd(n=nout);
  <A HREF="../../Modelica/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.OutPort"
>Modelica.Blocks.Interfaces.OutPort</A> qdd(n=nout);
<font color="blue">equation </font>
  <font color="blue">for </font>i<font color="blue"> in </font>1:nout<font color="blue"> loop</font>
    aux1[i] = p_deltaq[i]/p_qd_max[i];
    aux2[i] = p_deltaq[i]/p_qdd_max[i];
  <font color="blue">end for</font>;
  <font color="darkgreen"></font>
  sd_max_inv = <font color="red">max</font>(<font color="red">abs</font>(aux1));
  sdd_max_inv = <font color="red">max</font>(<font color="red">abs</font>(aux2));
  <font color="darkgreen"></font>
  <font color="blue">if </font>sd_max_inv &lt;= eps<font color="blue"> or </font>sdd_max_inv &lt;= eps<font color="blue"> then</font>
    sd_max = 0;
    sdd_max = 0;
    Ta1 = 0;
    Ta2 = 0;
    noWphase = false;
    Tv = 0;
    Te = 0;
    Ta1s = 0;
    Ta2s = 0;
    Tvs = 0;
    Tes = 0;
    sd_max2 = 0;
    s1 = 0;
    s2 = 0;
    s3 = 0;
    r_sdd = 0;
    r_sd = 0;
    r_s = 0;
  <font color="blue">else</font>
    sd_max = 1/<font color="red">max</font>(<font color="red">abs</font>(aux1));
    sdd_max = 1/<font color="red">max</font>(<font color="red">abs</font>(aux2));
    Ta1 = <font color="red">sqrt</font>(1/sdd_max);
    Ta2 = sd_max/sdd_max;
    noWphase = Ta2 &gt;= Ta1;
    Tv = <font color="blue">if </font>noWphase<font color="blue"> then </font>Ta1<font color="blue"> else </font>1/sd_max;
    Te = <font color="blue">if </font>noWphase<font color="blue"> then </font>Ta1 + Ta1<font color="blue"> else </font>Tv + Ta2;
    Ta1s = Ta1 + startTime;
    Ta2s = Ta2 + startTime;
    Tvs = Tv + startTime;
    Tes = Te + startTime;
    sd_max2 = sdd_max*Ta1;
    s1 = sdd_max*(<font color="blue">if </font>noWphase<font color="blue"> then </font>Ta1*Ta1<font color="blue"> else </font>Ta2*Ta2)/2;
    s2 = s1 + (<font color="blue">if </font>noWphase<font color="blue"> then </font>sd_max2*(Te - Ta1) - (sdd_max/2)*(Te - Ta1)^2<font color="blue">
       else </font>sd_max*(Tv - Ta2));
    s3 = s2 + sd_max*(Te - Tv) - (sdd_max/2)*(Te - Tv)*(Te - Tv);
    <font color="darkgreen"></font>
    <font color="blue">if </font>time &lt; startTime<font color="blue"> then</font>
      r_sdd = 0;
      r_sd = 0;
      r_s = 0;
    <font color="blue">elseif </font>noWphase<font color="blue"> then</font>
      <font color="blue">if </font>time &lt; Ta1s<font color="blue"> then</font>
        r_sdd = sdd_max;
        r_sd = sdd_max*(time - startTime);
        r_s = (sdd_max/2)*(time - startTime)*(time - startTime);
      <font color="blue">elseif </font>time &lt; Tes<font color="blue"> then</font>
        r_sdd = -sdd_max;
        r_sd = sd_max2 - sdd_max*(time - Ta1s);
        r_s = s1 + sd_max2*(time - Ta1s) - (sdd_max/2)*(time - Ta1s)*(time -
          Ta1s);
      <font color="blue">else</font>
        r_sdd = 0;
        r_sd = 0;
        r_s = s2;
      <font color="blue">end if</font>;
    <font color="blue">elseif </font>time &lt; Ta2s<font color="blue"> then</font>
      r_sdd = sdd_max;
      r_sd = sdd_max*(time - startTime);
      r_s = (sdd_max/2)*(time - startTime)*(time - startTime);
    <font color="blue">elseif </font>time &lt; Tvs<font color="blue"> then</font>
      r_sdd = 0;
      r_sd = sd_max;
      r_s = s1 + sd_max*(time - Ta2s);
    <font color="blue">elseif </font>time &lt; Tes<font color="blue"> then</font>
      r_sdd = -sdd_max;
      r_sd = sd_max - sdd_max*(time - Tvs);
      r_s = s2 + sd_max*(time - Tvs) - (sdd_max/2)*(time - Tvs)*(time - Tvs);
    <font color="blue">else</font>
      r_sdd = 0;
      r_sd = 0;
      r_s = s3;
    <font color="blue">end if</font>;
    <font color="darkgreen"></font>
  <font color="blue">end if</font>;
  <font color="darkgreen"></font>
  <font color="darkgreen">// acceleration</font>
  qdd.signal = p_deltaq*sdd;
  qd.signal = p_deltaq*sd;
  q.signal = p_q_begin + p_deltaq*s;
  endTime = Tes;
  <font color="darkgreen"></font>
  sd = <font color="red">der</font>(s);
  sdd = <font color="red">der</font>(sd);
  <font color="darkgreen"></font>
  constraintResidue = r_s - s;
  constraintResidue_d = r_sd - sd;
  constraintResidue_dd = r_sdd - sdd;
  <font color="red">constrain</font>(constraintResidue, constraintResidue_d, constraintResidue_dd);
<font color="blue">end </font>KinematicPTPc;
</PRE>
<HR>
<address>HTML-documentation generated by <a href="http://www.dynasim.se/">Dymola</a> Thu Mar 04 09:45:25 2004
.
</address></BODY>
</HTML>
